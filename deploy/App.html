<!DOCTYPE html>
<html>
<head>
    <title>S854907-PIScopeChangeSummary</title>

    <script type="text/javascript" src="/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",_initDate:void 0,_endDate:void 0,_myMask:void 0,_baseReleaseName:void 0,_baseReleaseId:void 0,_releases:void 0,_initFeatures:void 0,_endFeatures:void 0,_initDefects:void 0,_endDefects:void 0,_byProjectRows:void 0,_byTypeRows:void 0,_byFeatureRows:void 0,_byDefectRows:void 0,items:[{xtype:"container",itemId:"header",cls:"header"},{xtype:"container",itemId:"bodyContainer",layout:"anchor",width:"100%",height:"100%",autoScroll:!0}],launch:function(){var e=this.getContext().getProject().ObjectID;console.log("project:",e),this._projectId=e,this._myMask=new Ext.LoadMask({msg:"Please wait...",target:this});var t=Ext.create("Ext.form.field.Date",{fieldLabel:"Start Date:",listeners:{select:function(e,t){this._initDate=t.toISOString()},scope:this}}),a=Ext.create("Ext.form.field.Date",{fieldLabel:"End Date:",listeners:{select:function(e,t){this._endDate=t.toISOString()},scope:this}}),o=Ext.create("Rally.ui.combobox.ReleaseComboBox",{itemId:"releaseComboBox",fieldLabel:"Release",showArrows:!1,width:450,listeners:{ready:function(e){this._baseReleaseId=e.getRecord().get("ObjectID"),this._baseReleaseName=e.getRecord().get("Name")},select:function(e,t,a){this._baseReleaseId=e.getRecord().get("ObjectID"),this._baseReleaseName=e.getRecord().get("Name")},scope:this}}),r=Ext.create("Rally.ui.Button",{text:"Search",margin:"10 10 10 100",scope:this,handler:function(){this._doSearch()}});this.down("#header").add([{xtype:"panel",title:"PI Scope Change Filter:",layout:"vbox",align:"stretch",autoHeight:!0,bodyPadding:10,items:[{xtype:"fieldcontainer",layout:"hbox",width:800,items:[t,{xtype:"label",flex:1,margin:"0 0 0 20",name:"labelInit",text:"This represents the date of the commitment of the PI"}]},{xtype:"fieldcontainer",layout:"hbox",width:800,items:[a,{xtype:"label",flex:1,margin:"0 0 0 20",name:"labelEnd",text:"This represent the date you want to compare to - usually current date"}]},o,r]}])},_doSearch:function(){console.log("looking for data at:",this._initDate,this._endDate),(this._initDate&&""!==this._initDate||this._endDate&&""!==this._endDate)&&(this._loadReleases(),this._myMask.show())},_loadReleases:function(){Ext.create("Rally.data.wsapi.Store",{model:"Release",autoLoad:!0,context:{projectScopeUp:!1,projectScopeDown:!0,project:null},filters:Rally.data.QueryFilter.or([Rally.data.QueryFilter.and([{property:"Project.ObjectID",value:this._projectId},{property:"name",value:this._baseReleaseName}]),Rally.data.QueryFilter.or([Rally.data.QueryFilter.and([{property:"Project.parent.ObjectID",value:this._projectId},{property:"name",value:this._baseReleaseName}]),Rally.data.QueryFilter.and([{property:"Project.parent.parent.ObjectID",value:this._projectId},{property:"name",value:this._baseReleaseName}])])]),listeners:{load:function(e,t,a){if(t.length>0){console.log("multiple releases found:",t);var o=[];_.each(t,function(e){o.push(e.get("ObjectID"))}),this._releases=o,console.log("releases: ",this._releases)}else console.log("single release found, using baseReleaseId:",baseReleaseId),this._releases=[baseReleaseId];Deft.Chain.parallel([this._loadInitFeatures,this._loadEndFeatures,this._loadInitDefects,this._loadEndDefects],this).then({success:function(e){console.log("defects and features loaded:",e),this._buildSummaryProject(),this._buildSummaryType(),this._buildSummaryFeature(),this._buildSummaryDefect()},failure:function(e){console.log("error:",e)},scope:this})},scope:this},fetch:["Description","Name","ObjectID"],limit:1/0})},_loadInitFeatures:function(){var e=Ext.create("Deft.Deferred");console.log("loading init Features",this._initDate,this._endDate,this._projectId,this._baseReleaseId);var t=[{property:"__At",value:this._initDate},{property:"_TypeHierarchy",value:"PortfolioItem/Feature"},{property:"_ProjectHierarchy",value:this._projectId},{property:"Release",operator:"in",value:this._releases}];console.log("filters:",t);Ext.create("Rally.data.lookback.SnapshotStore",{fetch:["Name","FormattedID","LeafStoryPlanEstimateTotal","LeafStoryCount","PreliminaryEstimate","State","Parent","PercentDoneByStoryPlanEstimate","_ValidFrom","_ValidTo","Type"],hydrate:["State","Project"],filters:t,autoLoad:!0,limit:1/0,sorters:[{property:"ObjectID",direction:"ASC"}],listeners:{load:function(t,a,o){console.log("Init Features data loaded:",a),this._initFeatures=a,e.resolve(a)},scope:this}});return e.promise},_loadEndFeatures:function(){var e=Ext.create("Deft.Deferred");console.log("loading end Features",this._initDate,this._projectId);var t=[{property:"__At",value:this._endDate},{property:"_TypeHierarchy",value:"PortfolioItem/Feature"},{property:"_ProjectHierarchy",value:this._projectId},{property:"Release",operator:"in",value:this._releases}];Ext.create("Rally.data.lookback.SnapshotStore",{fetch:["Name","FormattedID","LeafStoryPlanEstimateTotal","LeafStoryCount","PreliminaryEstimate","State","Parent","PercentDoneByStoryPlanEstimate","_ValidFrom","_ValidTo","Type"],hydrate:["State","Project"],filters:t,autoLoad:!0,limit:1/0,sorters:[{property:"ObjectID",direction:"ASC"}],listeners:{load:function(t,a,o){console.log("end Features data loaded:",a),this._endFeatures=a,e.resolve(a)},scope:this}});return e.promise},_loadInitDefects:function(){var e=Ext.create("Deft.Deferred");console.log("loading init Defects",this._initDate,this._projectId);var t=[{property:"__At",value:this._initDate},{property:"_TypeHierarchy",value:"Defect"},{property:"_ProjectHierarchy",value:this._projectId},{property:"Release",operator:"in",value:this._releases}];Ext.create("Rally.data.lookback.SnapshotStore",{fetch:["Name","FormattedID","ObjectID","Project","ScheduleState","PlanEstimate","_ValidFrom","_ValidTo","Type"],hydrate:["ScheduleState","Project"],filters:t,autoLoad:!0,limit:1/0,sorters:[{property:"ObjectID",direction:"ASC"}],listeners:{load:function(t,a,o){console.log("init defects data loaded:",a),this._initDefects=a,e.resolve(a)},scope:this}});return e.promise},_loadEndDefects:function(){var e=Ext.create("Deft.Deferred");console.log("loading end Defects",this._endDate,this._projectId);var t=[{property:"__At",value:this._endDate},{property:"_TypeHierarchy",value:"Defect"},{property:"_ProjectHierarchy",value:this._projectId},{property:"Release",operator:"in",value:this._releases}];Ext.create("Rally.data.lookback.SnapshotStore",{fetch:["Name","FormattedID","ObjectID","ScheduleState","Project","PlanEstimate","_ValidFrom","_ValidTo","Type"],hydrate:["ScheduleState","Project"],filters:t,autoLoad:!0,limit:1/0,sorters:[{property:"ObjectID",direction:"ASC"}],listeners:{load:function(t,a,o){console.log("end defects data loaded:",a),this._endDefects=a,e.resolve(a)},scope:this}});return e.promise},_buildSummaryProject:function(){var e=this._createSummaryProjectStore(),t=Ext.create("Ext.grid.Panel",{store:e,forceFit:!0,viewConfig:{enableTextSelection:!0},columns:[{text:"Summary by Projects",flex:3,sortable:!0,dataIndex:"projectName"},{text:"Total Start Day",flex:1,sortable:!0,dataIndex:"totalStartDay"},{text:"Total End Day",flex:1,sortable:!0,dataIndex:"totalEndDay"},{text:"Adds",flex:1,sortable:!0,dataIndex:"adds"},{text:"Deletes",flex:1,sortable:!0,dataIndex:"deletes"},{text:"% Change",flex:1,sortable:!0,dataIndex:"percChange"}]}),a=Ext.create("Rally.ui.Button",{text:"Export by Project",margin:"10 10 10 10",scope:this,handler:function(){var e=this._convertToCSV(this._byProjectRows);console.log("converting to csv:",e);var t=document.createElement("a"),a=new Blob(["\ufeff",e]),o=URL.createObjectURL(a);t.href=o,t.download="report.csv",document.body.appendChild(t),t.click(),document.body.removeChild(t)}});this.down("#bodyContainer").removeAll(!0),this.down("#bodyContainer").add(a),this.down("#bodyContainer").add(t)},_buildSummaryType:function(){var e=this._createSummaryTypeStore(),t=Ext.create("Ext.grid.Panel",{store:e,margin:"20 0 0 0",forceFit:!0,viewConfig:{enableTextSelection:!0},columns:[{text:"Summary by Type",flex:3,sortable:!0,dataIndex:"typeName"},{text:"Total Start Day",flex:1,sortable:!0,dataIndex:"totalStartDay"},{text:"Total End Day",flex:1,sortable:!0,dataIndex:"totalEndDay"},{text:"Adds",flex:1,sortable:!0,dataIndex:"adds"},{text:"Deletes",flex:1,sortable:!0,dataIndex:"deletes"},{text:"% Change",flex:1,sortable:!0,dataIndex:"percChange"}]}),a=Ext.create("Rally.ui.Button",{text:"Export by Type",margin:"10 10 10 10",scope:this,handler:function(){var e=this._convertToCSV(this._byTypeRows);console.log("converting to csv:",e);var t=document.createElement("a"),a=new Blob(["\ufeff",e]),o=URL.createObjectURL(a);t.href=o,t.download="report.csv",document.body.appendChild(t),t.click(),document.body.removeChild(t)}});this.down("#bodyContainer").add(a),this.down("#bodyContainer").add(t)},_buildSummaryFeature:function(){var e=this._createSummaryFeatureStore(),t=Ext.create("Ext.grid.Panel",{store:e,margin:"20 0 0 0",forceFit:!0,viewConfig:{enableTextSelection:!0},columns:[{text:"Summary by Feature",flex:1,sortable:!0,dataIndex:"featureNumber"},{text:"Feature Name",flex:2,sortable:!0,dataIndex:"featureName"},{text:"Project Name",flex:1,sortable:!0,dataIndex:"projectName"},{text:"Total Start Day",flex:1,sortable:!0,dataIndex:"totalStartDay"},{text:"Total End Day",flex:1,sortable:!0,dataIndex:"totalEndDay"},{text:"Adds",flex:1,sortable:!0,dataIndex:"adds"},{text:"Deletes",flex:1,sortable:!0,dataIndex:"deletes"},{text:"% Change",flex:1,sortable:!0,dataIndex:"percChange"}]}),a=Ext.create("Rally.ui.Button",{text:"Export by Feature",margin:"10 10 10 10",scope:this,handler:function(){var e=this._convertToCSV(this._byFeatureRows);console.log("converting to csv:",e);var t=document.createElement("a"),a=new Blob(["\ufeff",e]),o=URL.createObjectURL(a);t.href=o,t.download="report.csv",document.body.appendChild(t),t.click(),document.body.removeChild(t)}});this.down("#bodyContainer").add(a),this.down("#bodyContainer").add(t)},_buildSummaryDefect:function(){var e=this._createSummaryDefectStore(),t=Ext.create("Ext.grid.Panel",{store:e,margin:"20 0 0 0",forceFit:!0,viewConfig:{enableTextSelection:!0},columns:[{text:"Summary by Defect",flex:1,sortable:!0,dataIndex:"defectNumber"},{text:"Defect Name",flex:2,sortable:!0,dataIndex:"defectName"},{text:"Project Name",flex:1,sortable:!0,dataIndex:"projectName"},{text:"Total Start Day",flex:1,sortable:!0,dataIndex:"totalStartDay"},{text:"Total End Day",flex:1,sortable:!0,dataIndex:"totalEndDay"},{text:"Adds",flex:1,sortable:!0,dataIndex:"adds"},{text:"Deletes",flex:1,sortable:!0,dataIndex:"deletes"},{text:"% Change",flex:1,sortable:!0,dataIndex:"percChange"}]}),a=Ext.create("Rally.ui.Button",{text:"Export by Defect",margin:"10 10 10 10",scope:this,handler:function(){var e=this._convertToCSV(this._byDefectRows);console.log("converting to csv:",e);var t=document.createElement("a"),a=new Blob(["\ufeff",e]),o=URL.createObjectURL(a);t.href=o,t.download="report.csv",document.body.appendChild(t),t.click(),document.body.removeChild(t)}});this.down("#bodyContainer").add(a),this.down("#bodyContainer").add(t),this._myMask.hide()},_createDefectRowSummaryByType:function(){var e=0,t=0,a=0,o=0,r=[],n=[];_.each(this._initDefects,function(e){r.push(e.get("ObjectID"))},this),_.each(this._endDefects,function(e){n.push(e.get("ObjectID"))},this),_.each(this._initDefects,function(t){var r=t.get("ObjectID"),i=t.get("PlanEstimate");if(e+=i,Ext.Array.contains(n,r)){var s=this._getEndFeatureByObjectId(r,this._endDefects).get("PlanEstimate");i>s?a+=i-s:o+=s-i}else a+=t.get("PlanEstimate")},this),_.each(this._endDefects,function(e){var a=e.get("ObjectID"),n=e.get("PlanEstimate");t+=e.get("PlanEstimate"),Ext.Array.contains(r,a)||(o+=n)},this);var i=0;return t>e&&(i=(100*(t/e-1)).toFixed(2)+"%"),e>t&&(i=(100*(t/e-1)).toFixed(2)+"%"),{typeName:"Defect",totalStartDay:e,totalEndDay:t,adds:o,deletes:a,percChange:i}},_createSummaryProjectStore:function(){var e=[],t=new Ext.util.MixedCollection,a=new Ext.util.MixedCollection;_.each(this._initFeatures,function(e){var a=e.get("Project").Name;if(t.containsKey(a))t.get(a).push(e);else{var o=[];o.push(e),t.add(a,o)}},this),_.each(this._endFeatures,function(e){var t=e.get("Project").Name;if(a.containsKey(t))a.get(t).push(e);else{var o=[];o.push(e),a.add(t,o)}},this),_.each(this._initDefects,function(e){var a=e.get("Project").Name;if(t.containsKey(a))t.get(a).push(e);else{var o=[];o.push(e),t.add(a,o)}},this),_.each(this._endDefects,function(e){var t=e.get("Project").Name;if(a.containsKey(t))a.get(t).push(e);else{var o=[];o.push(e),a.add(t,o)}},this),t.eachKey(function(o,r){var n,i=0,s=0,l=0;_.each(r,function(e){var t=e.get("FormattedID").startsWith("F")?"PortfolioItem/Feature":"Defect",r=e.get("ObjectID"),n=this._getEndFeatureByObjectId(r,a.get(o)),d=0,c=0;"PortfolioItem/Feature"===t?(d=e.get("LeafStoryPlanEstimateTotal"),i+=d,n&&(c=n.get("LeafStoryPlanEstimateTotal"))):(d=e.get("PlanEstimate"),i+=d,n&&(c=n.get("PlanEstimate"))),n&&(c>d?s+=c-d:l+=d-c)},this),s+=this._getTotalPointsOfFeaturesAddedAfterInitDay(o,a,t),l+=this._getTotalPointsOfFeaturesRemovedBeforeEndDay(o,t,a),n=this._calculateTotalEndDay(o,a);var d,c=s,u=l;d=(100*(n/i-1)).toFixed(2)+"%";var f={projectName:o,totalStartDay:i,totalEndDay:n,adds:c,deletes:u,percChange:d};e.push(f)},this),a.eachKey(function(o,r){if(!t.containsKey(o)){console.log("project added at end:",o,r);var n=this._calculateTotalEndDay(o,a),i=this._calculateAdds(0,n),s={projectName:o,totalStartDay:0,totalEndDay:n,adds:i,deletes:this._calculateDeletes(0,n),percChange:(100*i).toFixed(2)+"%"};e.push(s)}},this),console.log("rows",e),this._byProjectRows=e;var o=Ext.create("Ext.data.JsonStore",{fields:["projectName","totalStartDay","totalEndDay","adds","deletes","percChange"]});return o.loadData(e),o},_getEndFeatureByObjectId:function(e,t){var a;return _.each(t,function(t){t.get("ObjectID")===e&&(a=t)},this),a},_getInitFeatureByObjectId:function(e,t){var a;return _.each(t,function(t){t.get("ObjectID")===e&&(a=t)},this),a},_getTotalPointsOfFeaturesAddedAfterInitDay:function(e,t,a){var o=0;if(console.log("looking for project:",e),t.containsKey(e)){var r=t.get(e);_.each(r,function(t){var r=t.get("ObjectID");if(!this._getInitFeatureByObjectId(r,a.get(e))){var n=0;n="PortfolioItem/Feature"===(t.get("FormattedID").startsWith("F")?"PortfolioItem/Feature":"Defect")?t.get("LeafStoryPlanEstimateTotal"):t.get("PlanEstimate"),o+=n}},this)}return console.log("complete add points:",o),o},_getTotalPointsOfFeaturesRemovedBeforeEndDay:function(e,t,a){var o=0;if(t.containsKey(e)){var r=t.get(e);_.each(r,function(t){var r=t.get("ObjectID");if(!this._getEndFeatureByObjectId(r,a.get(e))){var n=0;n="PortfolioItem/Feature"===(t.get("FormattedID").startsWith("F")?"PortfolioItem/Feature":"Defect")?t.get("LeafStoryPlanEstimateTotal"):t.get("PlanEstimate"),o+=n}},this)}return console.log("complete del points:",o),o},_createSummaryTypeStore:function(){var e=[],t=0,a=0,o=0,r=0,n=[],i=[];_.each(this._initFeatures,function(e){n.push(e.get("ObjectID"))},this),_.each(this._endFeatures,function(e){i.push(e.get("ObjectID"))},this),_.each(this._initFeatures,function(e){var a=e.get("ObjectID"),n=e.get("LeafStoryPlanEstimateTotal");if(t+=n,Ext.Array.contains(i,a)){var s=this._getEndFeatureByObjectId(a,this._endFeatures).get("LeafStoryPlanEstimateTotal");n>s?o+=n-s:r+=s-n}else o+=e.get("LeafStoryPlanEstimateTotal")},this),_.each(this._endFeatures,function(e){var t=e.get("ObjectID");a+=e.get("LeafStoryPlanEstimateTotal"),Ext.Array.contains(n,t)||(r+=e.get("LeafStoryPlanEstimateTotal"))},this);var s=0;a>t&&(s=(100*(a/t-1)).toFixed(2)+"%"),t>a&&(s=(100*(a/t-1)).toFixed(2)+"%"),e.push({typeName:"Feature",totalStartDay:t,totalEndDay:a,adds:r,deletes:o,percChange:s});var l=this._createDefectRowSummaryByType();e.push(l),this._byTypeRows=e,console.log("rows",e);var d=Ext.create("Ext.data.JsonStore",{fields:["typeName","totalStartDay","totalEndDay","adds","deletes","percChange"]});return d.loadData(e),d},_getFeatureRow:function(){return{featureName:"",featureTotalStart:0,featureTotalEnd:0,adds:0,deletes:0,percChange:""}},_getDefectRow:function(){return{defectName:"",defectTotalStart:0,defectTotalEnd:0,adds:0,deletes:0,percChange:""}},_createSummaryFeatureStore:function(){var e=[],t=[],a=[],o=new Ext.util.MixedCollection;_.each(this._initFeatures,function(e){var a=e.get("ObjectID");if(t.push(a),o.containsKey(a))o.get(a).featureTotalStart=e.get("LeafStoryPlanEstimateTotal");else{var r=this._getFeatureRow();r.featureNumber=e.get("FormattedID"),r.featureName=e.get("Name"),r.featureTotalStart=e.get("LeafStoryPlanEstimateTotal"),r.projectName=e.get("Project").Name,o.add(a,r)}},this),_.each(this._endFeatures,function(e){var t=e.get("ObjectID");if(a.push(t),o.containsKey(t))o.get(t).featureTotalEnd=e.get("LeafStoryPlanEstimateTotal");else{var r=this._getFeatureRow();r.featureNumber=e.get("FormattedID"),r.featureName=e.get("Name"),r.featureTotalEnd=e.get("LeafStoryPlanEstimateTotal"),r.projectName=e.get("Project").Name,console.log("complete add, not available at init",r),o.add(t,r)}},this),_.each(this._initFeatures,function(e){var t=e.get("ObjectID");Ext.Array.contains(a,t)||(o.get(t).featureTotalDelete=e.get("LeafStoryPlanEstimateTotal"))},this),_.each(this._endFeatures,function(e){var a=e.get("ObjectID");if(Ext.Array.contains(t,a)){var r=e.get("LeafStoryPlanEstimateTotal")-o.get(a).featureTotalStart;r>0?o.get(a).featureTotalAdd=r:o.get(a).featureTotalDelete=-1*r}else o.get(a).featureTotalAdd=e.get("LeafStoryPlanEstimateTotal")},this),o.eachKey(function(t,a){var o=a.featureTotalStart,r=a.featureTotalEnd,n=a.featureTotalAdd,i=0;0===o?i=(r/(o=1)*100).toFixed(2)+"%":r<o?i="-"+(100*(1-r/o)).toFixed(2)+"%":o<r&&(i=(n/o*100).toFixed(2)+"%");var s={featureNumber:a.featureNumber,featureName:a.featureName,projectName:a.projectName,totalStartDay:a.featureTotalStart,totalEndDay:a.featureTotalEnd,adds:a.featureTotalAdd,deletes:a.featureTotalDelete,percChange:i};e.push(s)},this),console.log("rows",e),this._byFeatureRows=e;var r=Ext.create("Ext.data.JsonStore",{fields:["featureNumber","featureName","projectName","totalStartDay","totalEndDay","adds","deletes","percChange"]});return r.loadData(e),r},_createSummaryDefectStore:function(){var e=[],t=[],a=[],o=new Ext.util.MixedCollection;_.each(this._initDefects,function(e){var a=e.get("ObjectID");if(t.push(a),o.containsKey(a)){var r=o.get(a);if(r.defectTotalStart=e.get("PlanEstimate"),n=this._getEndFeatureByObjectId(a,this._endFeatures))(i=n.get("PlanEstimate"))>e.get("PlanEstimate")?r.defectTotalAdd=i-e.get("PlanEstimate"):r.defectTotalDelete=e.get("PlanEstimate")-i;else r.defectTotalDelete=e.get("PlanEstimate")}else{var n,i,s=this._getDefectRow();if(s.defectNumber=e.get("FormattedID"),s.defectName=e.get("Name"),s.defectTotalStart=e.get("PlanEstimate"),s.projectName=e.get("Project").Name,n=this._getEndFeatureByObjectId(a,this._endDefects))(i=n.get("PlanEstimate"))>e.get("PlanEstimate")?s.defectTotalAdd=i-e.get("PlanEstimate"):s.defectTotalDelete=e.get("PlanEstimate")-i;else s.defectTotalDelete=e.get("PlanEstimate");o.add(a,s)}},this),_.each(this._endDefects,function(e){var t=e.get("ObjectID");if(a.push(t),o.containsKey(t)){var r=o.get(t);if(r.defectTotalEnd=e.get("PlanEstimate"),n=this._getInitFeatureByObjectId(t,this._initDefects))(i=n.get("PlanEstimate"))>e.get("PlanEstimate")?r.defectTotalDelete=i-e.get("PlanEstimate"):r.defectTotalAdd=e.get("PlanEstimate")-i;else r.defectTotalAdd=e.get("PlanEstimate")}else{var n,i,s=this._getDefectRow();if(s.defectNumber=e.get("FormattedID"),s.defectName=e.get("Name"),s.defectTotalEnd=e.get("PlanEstimate"),s.projectName=e.get("Project").Name,n=this._getInitFeatureByObjectId(t,this._initDefects))(i=n.get("PlanEstimate"))>e.get("PlanEstimate")?s.defectTotalDelete=i-e.get("PlanEstimate"):s.defectTotalAdd=e.get("PlanEstimate")-i;else s.defectTotalAdd=e.get("PlanEstimate");o.add(t,s)}},this),o.eachKey(function(t,a){var o=a.defectTotalStart,r=a.defectTotalEnd,n=a.defectTotalAdd,i=0;0===o?i=(r/(o=1)*100).toFixed(2)+"%":r<o?i="-"+(100*(1-r/o)).toFixed(2)+"%":o<r&&(i=(n/o*100).toFixed(2)+"%");var s={defectNumber:a.defectNumber,defectName:a.defectName,projectName:a.projectName,totalStartDay:a.defectTotalStart,totalEndDay:a.defectTotalEnd,adds:a.defectTotalAdd,deletes:a.defectTotalDelete,percChange:i};e.push(s)},this),console.log("rows",e),this._byDefectRows=e;var r=Ext.create("Ext.data.JsonStore",{fields:["defectNumber","defectName","projectName","totalStartDay","totalEndDay","adds","deletes","percChange"]});return r.loadData(e),r},_calculateTotalEndDay:function(e,t){if(t.containsKey(e)){var a=0;return _.each(t.get(e),function(e){var t=e.get("FormattedID").startsWith("F")?"PortfolioItem/Feature":"Defect";a+="PortfolioItem/Feature"===t?e.get("LeafStoryPlanEstimateTotal"):e.get("PlanEstimate")},this),console.log("calc total at end Day:",a),a}return 0},_calculateAdds:function(e,t){var a=0;return t>e&&(a=t-e),a},_calculateDeletes:function(e,t){var a=0;return t<e&&(a=e-t),a},_convertToCSV:function(e){var t=Object.keys(e[0]),a=function(e,t){return null===t?"":t},o=e.map(function(e){return t.map(function(t){return JSON.stringify(e[t],a)}).join(",")});return o.unshift(t.join(",")),o.join("\r\n")}});

            Rally.launchApp('CustomApp', {
                name:"S854907-PIScopeChangeSummary",
                parentRepos:"",
                version:"0.1.1"
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
